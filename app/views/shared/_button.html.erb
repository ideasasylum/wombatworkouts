<%
# Button Component
#
# A flexible button component with multiple styles matching minimalist design system
#
# @param text [String, nil] Button text (optional for icon-only buttons)
# @param url [String, nil] Link destination (optional, makes it a link_to instead of button)
# @param http_method [Symbol, nil] HTTP method for link_to (e.g., :delete, :post)
# @param type [Symbol] Button type - :primary, :secondary, :icon_only
# @param size [Symbol] Button size - :small, :base, :large
# @param icon [String, nil] Icon to display (optional) - renders shared/icons partial
# @param icon_position [Symbol] Icon position - :left or :right (default: :left)
# @param html_options [Hash] Additional HTML options (class, data, aria-label, etc.)
# @param full_width [Boolean] Make button full width on mobile (default: false)

type = local_assigns.fetch(:type, :primary)
size = local_assigns.fetch(:size, :base)
icon = local_assigns.fetch(:icon, nil)
text = local_assigns.fetch(:text, nil)
icon_position = local_assigns.fetch(:icon_position, :left)
html_options = local_assigns.fetch(:html_options, {})
full_width = local_assigns.fetch(:full_width, false)
http_method = local_assigns.fetch(:http_method, nil)

# Base classes - minimal design with 2px border radius
base_classes = "inline-flex items-center justify-center border font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors"

# Apply 2px border radius (minimal)
radius_class = "rounded-sm" # rounded-sm = 2px in our custom config

# Size classes with proper touch targets (min 44x44px)
size_classes = case size
when :small
  "px-3 py-2 text-sm min-h-[44px]"
when :large
  "px-8 py-4 text-lg font-bold min-h-[44px]"
else # :base
  "px-6 py-3 text-base min-h-[44px]"
end

# Type/color classes - black/white monochrome palette
type_classes = case type
when :primary
  # Solid black background, white text
  "border-transparent text-white bg-[rgb(26,26,26)] hover:opacity-90 focus:ring-gray-900"
when :secondary
  # White background with grey border, black text
  "border-[rgb(204,204,204)] border text-[rgb(26,26,26)] bg-white hover:bg-gray-50 focus:ring-gray-900"
when :icon_only
  # Minimal styling for icon-only buttons
  "border-transparent bg-transparent text-[rgb(26,26,26)] hover:bg-gray-100 focus:ring-gray-900 p-2 min-h-[44px] min-w-[44px]"
else
  # Default to primary
  "border-transparent text-white bg-[rgb(26,26,26)] hover:opacity-90 focus:ring-gray-900"
end

# Full width on mobile
width_classes = full_width ? "w-full sm:w-auto" : ""

# Merge all classes
final_classes = [base_classes, radius_class, size_classes, type_classes, width_classes, html_options[:class]].compact.join(" ")
final_html_options = html_options.except(:class).merge(class: final_classes)

# For icon-only buttons, ensure aria-label is present for accessibility
if type == :icon_only && text.nil? && !final_html_options[:"aria-label"]
  # Try to infer aria-label from icon name if not provided
  final_html_options[:"aria-label"] = icon.to_s.humanize if icon
end

# Icon sizing based on button type
icon_size = type == :icon_only ? "w-5 h-5" : "w-5 h-5"
icon_margin = if type == :icon_only
  "" # No margin for icon-only
elsif icon_position == :left && text.present?
  "mr-2"
elsif icon_position == :right && text.present?
  "ml-2"
else
  ""
end

# Build button content
button_content = capture do
  if icon && icon_position == :left
    concat render("shared/icons/#{icon}", class: "#{icon_size} #{icon_margin}")
  end
  concat text if text.present?
  if icon && icon_position == :right
    concat render("shared/icons/#{icon}", class: "#{icon_size} #{icon_margin}")
  end
end
%>

<% if url %>
  <% link_options = final_html_options.dup %>
  <% link_options[:method] = http_method if http_method.present? %>
  <%= link_to button_content.html_safe, url, link_options %>
<% else %>
  <%= content_tag(:button, button_content.html_safe, final_html_options.merge(type: 'button')) %>
<% end %>
