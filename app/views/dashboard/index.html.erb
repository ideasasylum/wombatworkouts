<%
# Dashboard View
#
# Main dashboard showing recent programs and workouts
# Uses minimalist card-based layout matching prototype design
%>

<div class="min-h-screen py-6 md:py-12 px-4 sm:px-6 lg:px-8 w-full">
  <div class="max-w-7xl mx-auto">
    <!-- Programs Section -->
    <section>
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-h1 text-[rgb(26,26,26)]">Programs</h1>
        <%= render 'shared/button',
          text: 'New',
          url: new_program_path,
          type: :secondary,
          size: :small,
          icon: 'plus',
          icon_position: :left,
          html_options: { class: 'md:w-32 !bg-[rgb(237,242,247)]' } %>
      </div>

      <% if @programs.empty? %>
        <!-- Empty state -->
        <div class="bg-white border border-[rgb(204,204,204)] p-12 text-center">
          <div class="max-w-md mx-auto">
            <h2 class="text-h2 text-[rgb(26,26,26)] mb-2">Create Your First Program</h2>
            <p class="text-body text-[rgb(107,114,128)] mb-6">Get started by creating your first exercise program to organize your workouts</p>
            <%= render 'shared/button',
              text: 'New Program',
              url: new_program_path,
              type: :primary,
              size: :base,
              icon: 'plus',
              icon_position: :left %>
          </div>
        </div>
      <% else %>
        <!-- Program cards -->
        <div class="space-y-4">
          <% @programs.each do |program| %>
            <div class="bg-white border border-[rgb(204,204,204)] p-6" data-controller="collapsible">
              <!-- Title and Start button row -->
              <div class="flex items-start justify-between mb-2">
                <%= link_to program_path(program), class: "block group flex-1" do %>
                  <h3 class="text-xl font-semibold text-gray-900 group-hover:text-[rgb(107,114,128)] transition-colors"><%= program.title %></h3>
                <% end %>

                <%= render 'shared/button',
                  text: 'Start',
                  url: new_workout_path(program_id: program.uuid),
                  type: :primary,
                  size: :small,
                  icon: 'play',
                  icon_position: :left,
                  html_options: { class: 'md:w-32 flex-shrink-0 ml-4' } %>
              </div>

              <!-- Description (only show if present) -->
              <% if program.description.present? %>
                <p class="text-body text-[rgb(107,114,128)] mb-4 line-clamp-3"><%= truncate(program.description, length: 120) %></p>
              <% end %>

              <!-- More details and actions row -->
              <div class="flex items-center justify-between <%= 'mt-4' unless program.description.present? %>">
                <!-- More details toggle -->
                <button
                  type="button"
                  data-action="click->collapsible#toggle"
                  class="inline-flex items-center text-sm text-[rgb(26,26,26)] hover:text-[rgb(107,114,128)] transition-colors focus:outline-none"
                >
                  <span class="mr-1">More details</span>
                  <%= render 'shared/icons/chevron_down', class: 'w-4 h-4 transition-transform duration-200', data: { collapsible_target: 'arrow' } %>
                </button>

                <!-- Edit and Delete icon buttons -->
                <div class="flex items-center space-x-2">
                  <%= render 'shared/button',
                    url: edit_program_path(program),
                    type: :icon_only,
                    icon: 'pencil',
                    html_options: { 'aria-label': 'Edit program' } %>

                  <%= button_to program_path(program),
                    method: :delete,
                    form: { data: { turbo_confirm: "Are you sure you want to delete '#{program.title}'?" } },
                    class: "inline-flex items-center justify-center p-2 rounded-sm text-[rgb(26,26,26)] hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-900 min-h-[44px] min-w-[44px]",
                    'aria-label': 'Delete program' do %>
                    <%= render 'shared/icons/trash', class: 'w-5 h-5' %>
                  <% end %>
                </div>
              </div>

              <!-- Collapsible exercise summary -->
              <div class="hidden mt-4 pt-4 border-t border-[rgb(204,204,204)]" data-collapsible-target="content">
                <% if program.exercises.any? %>
                  <h4 class="text-sm font-medium text-[rgb(26,26,26)] mb-2">Exercises</h4>
                  <ul class="space-y-1">
                    <% program.exercises.order(:position).each do |exercise| %>
                      <li class="text-sm text-[rgb(107,114,128)]">
                        <%= exercise.name %> (<%= exercise.repeat_count %> sets)
                      </li>
                    <% end %>
                  </ul>
                <% else %>
                  <p class="text-sm text-[rgb(107,114,128)] italic">No exercises yet</p>
                <% end %>
              </div>
            </div>
          <% end %>

          <!-- View All Programs link (if more exist) -->
          <% if @has_more_programs %>
            <div class="text-center pt-2">
              <%= link_to "View All Programs", programs_path, class: "text-body text-[rgb(26,26,26)] hover:text-[rgb(107,114,128)] font-medium" %>
            </div>
          <% end %>
        </div>
      <% end %>
    </section>

    <!-- Recent Workouts Section (if any exist) -->
    <% if @workouts.any? %>
      <section class="mt-12">
        <div class="mb-6">
          <h2 class="text-h1 text-[rgb(26,26,26)]">Recent Workouts</h2>
        </div>

        <!-- Workout cards -->
        <div class="space-y-4">
          <% @workouts.each do |workout| %>
            <%= render 'workouts/card', workout: workout, show_delete: false %>
          <% end %>

          <!-- View All Workouts link -->
          <% if @has_more_workouts %>
            <div class="text-center pt-2">
              <%= link_to "View All Workouts", workouts_path, class: "text-body text-[rgb(26,26,26)] hover:text-[rgb(107,114,128)] font-medium" %>
            </div>
          <% end %>
        </div>
      </section>
    <% end %>
  </div>
</div>
