<div class="min-h-screen py-6 md:py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">
    <% if @workout.complete? && params[:exercise_index].blank? %>
      <%= render 'completion' %>
    <% else %>
      <!-- Progress indicator at top -->
      <% if @current_exercise %>
        <div class="mb-6">
          <div class="flex items-center justify-between mb-2">
            <span class="text-[rgb(107,114,128)]">
              Exercise <%= @stats[:completed_count] + @stats[:skipped_count] + 1 %> of <%= @stats[:total_count] %>
            </span>
            <span class="text-[rgb(107,114,128)] font-medium">
              <%= ((@stats[:completed_count] + @stats[:skipped_count]).to_f / @stats[:total_count] * 100).round %>%
            </span>
          </div>
          <div class="w-full bg-gray-200 rounded-sm h-2">
            <div class="bg-[rgb(26,26,26)] h-2 rounded-sm transition-all duration-300" style="width: <%= ((@stats[:completed_count] + @stats[:skipped_count]).to_f / @stats[:total_count] * 100).round %>%"></div>
          </div>
        </div>
      <% end %>

      <!-- Current exercise card -->
      <div class="bg-white border border-[rgb(204,204,204)] p-6 mb-6">
        <!-- Back to Summary button for completed workouts -->
        <% if @workout.complete? && params[:exercise_index].present? %>
          <div class="mb-6">
            <%= link_to workout_path(@workout), class: "inline-flex items-center text-[rgb(26,26,26)] hover:opacity-70" do %>
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
              </svg>
              Back to Summary
            <% end %>
          </div>
        <% end %>

        <% if @current_exercise %>
          <!-- Exercise name (h2 style per spec) -->
          <h2 class="text-h2 text-[rgb(26,26,26)] mb-3"><%= @current_exercise["name"] %></h2>

          <!-- Set information -->
          <% if @current_exercise["repeat_total"] > 1 %>
            <p class="text-[rgb(107,114,128)] mb-4">Set <%= @current_exercise["repeat_instance"] %> of <%= @current_exercise["repeat_total"] %></p>
          <% end %>

          <!-- Exercise description -->
          <% if @current_exercise["description"].present? %>
            <div class="mb-6">
              <p class="text-[rgb(26,26,26)] whitespace-pre-wrap"><%= @current_exercise["description"] %></p>
            </div>
          <% end %>

          <!-- Video embed if present -->
          <% if @current_exercise["video_url"].present? %>
            <div class="mb-6">
              <div class="aspect-video rounded-sm overflow-hidden bg-gray-100">
                <% video_id = @current_exercise["video_url"].match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&?]+)/)&.[](1) %>
                <% if video_id %>
                  <iframe class="w-full h-full" src="https://www.youtube-nocookie.com/embed/<%= video_id %>" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                <% end %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>

      <!-- Desktop action buttons (visible on desktop) -->
      <% if @current_exercise %>
        <div class="hidden md:flex gap-4">
          <%= button_to skip_workout_path(@workout), method: :patch, params: { exercise_id: @current_exercise["id"] }, class: "flex-1 inline-flex items-center justify-center border font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors rounded-sm px-6 py-3 text-base min-h-[44px] border-[rgb(26,26,26)] border text-[rgb(26,26,26)] bg-white hover:bg-gray-50 focus:ring-gray-900" do %>
            <%= render 'shared/icons/skip_forward', class: 'w-5 h-5 mr-2' %>
            Skip
          <% end %>
          <%= button_to mark_complete_workout_path(@workout), method: :patch, params: { exercise_id: @current_exercise["id"] }, class: "flex-1 inline-flex items-center justify-center border font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors rounded-sm px-6 py-3 text-base min-h-[44px] border-transparent text-white bg-[rgb(26,26,26)] hover:opacity-90 focus:ring-gray-900" do %>
            <%= render 'shared/icons/check', class: 'w-5 h-5 mr-2' %>
            Mark Complete
          <% end %>
        </div>

        <!-- Mobile floating action buttons (visible on mobile only) -->
        <div class="fixed bottom-0 left-0 right-0 md:hidden bg-white border-t border-[rgb(229,231,235)] shadow-lg p-4 z-50">
          <div class="flex gap-3 max-w-7xl mx-auto">
            <%= button_to skip_workout_path(@workout), method: :patch, params: { exercise_id: @current_exercise["id"] }, class: "flex-1 inline-flex items-center justify-center border font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors rounded-sm px-6 py-3 text-base min-h-[44px] border-[rgb(26,26,26)] border text-[rgb(26,26,26)] bg-white hover:bg-gray-50 focus:ring-gray-900" do %>
              <%= render 'shared/icons/skip_forward', class: 'w-5 h-5 mr-2' %>
              Skip
            <% end %>
            <%= button_to mark_complete_workout_path(@workout), method: :patch, params: { exercise_id: @current_exercise["id"] }, class: "flex-1 inline-flex items-center justify-center border font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors rounded-sm px-6 py-3 text-base min-h-[44px] border-transparent text-white bg-[rgb(26,26,26)] hover:opacity-90 focus:ring-gray-900" do %>
              <%= render 'shared/icons/check', class: 'w-5 h-5 mr-2' %>
              Mark Complete
            <% end %>
          </div>
        </div>

        <!-- Add bottom padding on mobile to prevent content being hidden by floating buttons -->
        <div class="h-24 md:hidden"></div>
      <% end %>
    <% end %>
  </div>
</div>
