# Secrets defined here are available for reference under registry/password, env/secret, builder/secrets,
# and accessories/*/env/secret in config/deploy.yml. All secrets should be pulled from either
# password manager, ENV, or a file. DO NOT ENTER RAW CREDENTIALS HERE! This file needs to be safe for git.

# Example of extracting secrets from 1password (or another compatible pw manager)
# SECRETS=$(kamal secrets fetch --adapter 1password --account your-account --from Vault/Item KAMAL_REGISTRY_PASSWORD RAILS_MASTER_KEY)
SECRETS=$(kamal secrets fetch --adapter 1password --account ballywilliam.1password.com --from Private/"Cloudflare wombatworkouts backup token" username credential)
# KAMAL_REGISTRY_PASSWORD=$(kamal secrets extract KAMAL_REGISTRY_PASSWORD ${SECRETS})
# RAILS_MASTER_KEY=$(kamal secrets extract RAILS_MASTER_KEY ${SECRETS})

# Example of extracting secrets from Rails credentials
# KAMAL_REGISTRY_PASSWORD=$(rails credentials:fetch kamal.registry_password)

# Use a GITHUB_TOKEN if private repositories are needed for the image
# GITHUB_TOKEN=$(gh config get -h github.com oauth_token)

# Grab secrets from .env file
VAPID_PUBLIC_KEY=$(grep VAPID_PUBLIC_KEY .env | cut -d '=' -f2)
VAPID_PRIVATE_KEY=$(grep VAPID_PRIVATE_KEY .env | cut -d '=' -f2)
APPSIGNAL_PUSH_API_KEY=$(grep APPSIGNAL_PUSH_API_KEY .env | cut -d '=' -f2)
POSTMARK_API_TOKEN=$(grep POSTMARK_API_TOKEN .env | cut -d '=' -f2)

# Improve security by using a password manager. Never check config/master.key into git!
RAILS_MASTER_KEY=$(cat config/master.key)

# GitHub Container Registry authentication - uses gh CLI to generate token
KAMAL_REGISTRY_PASSWORD=$(gh auth token)

# Litestream cloud storage credentials for SQLite backups
# IMPORTANT: Replace these placeholder values with your actual cloud storage credentials from Task Group 3
# After creating your S3-compatible storage bucket (AWS S3, Backblaze B2, DigitalOcean Spaces, etc.),
# replace the placeholder values below with your actual access key ID and secret access key.
#
# To get these credentials:
# - AWS S3: Create IAM user with S3 access, generate access keys
# - Backblaze B2: Create application key in B2 console
# - DigitalOcean Spaces: Generate Spaces access keys in API settings
#
LITESTREAM_ACCESS_KEY_ID=$(kamal secrets extract username ${SECRETS})
LITESTREAM_SECRET_ACCESS_KEY=$(kamal secrets extract credential ${SECRETS})
